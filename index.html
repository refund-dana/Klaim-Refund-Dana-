<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Manajemen Keuangan & Stok</title>
    <style>
        :root {
            --primary: #2563eb;       /* Biru Utama */
            --secondary: #64748b;     /* Abu-abu */
            --success: #10b981;       /* Hijau (Masuk/Untung) */
            --danger: #ef4444;        /* Merah (Keluar/Rugi) */
            --bg-light: #f1f5f9;
            --white: #ffffff;
            --border: #e2e8f0;
            --text-dark: #1e293b;
            --sidebar-width: 260px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', 'Segoe UI', sans-serif; }
        
        body { background-color: var(--bg-light); color: var(--text-dark); display: flex; min-height: 100vh; }

        /* Sidebar Navigation */
        .sidebar {
            width: var(--sidebar-width);
            background: #1e293b;
            color: white;
            padding: 2rem 1.5rem;
            position: fixed;
            height: 100vh;
            left: 0; top: 0;
            display: flex;
            flex-direction: column;
        }
        
        .brand { font-size: 1.4rem; font-weight: 700; margin-bottom: 2.5rem; color: var(--white); border-bottom: 1px solid #334155; padding-bottom: 1rem; }
        
        .nav-item {
            padding: 0.8rem 1rem;
            margin-bottom: 0.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.3s;
            color: #94a3b8;
            font-weight: 500;
        }
        
        .nav-item:hover, .nav-item.active { background: var(--primary); color: white; }

        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            flex: 1;
            padding: 2rem;
        }

        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .date-display { font-weight: 600; color: var(--secondary); background: white; padding: 0.5rem 1rem; border-radius: 8px; border: 1px solid var(--border); }

        /* Dashboard Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .card { background: var(--white); padding: 1.5rem; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); border: 1px solid var(--border); }
        .card-label { font-size: 0.85rem; color: var(--secondary); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
        .card-value { font-size: 1.6rem; font-weight: 700; margin-top: 0.5rem; }
        .text-green { color: var(--success); }
        .text-red { color: var(--danger); }
        .text-blue { color: var(--primary); }

        /* Form Section */
        .input-section {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
            border-left: 5px solid var(--primary);
        }

        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; align-items: end; }
        
        .form-group label { display: block; font-size: 0.85rem; margin-bottom: 0.4rem; font-weight: 500; }
        .form-group input, .form-group select {
            width: 100%; padding: 0.7rem; border: 1px solid var(--border); border-radius: 6px; outline: none; transition: 0.2s;
        }
        .form-group input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37,99,235,0.1); }

        button.btn-submit {
            background: var(--primary); color: white; border: none; padding: 0.7rem 1.5rem; border-radius: 6px; cursor: pointer; font-weight: 600; height: 42px; width: 100%;
        }
        button.btn-submit:hover { background: #1d4ed8; }

        /* Tables */
        .table-wrapper { background: var(--white); border-radius: 12px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.05); margin-bottom: 2rem; }
        .table-header { padding: 1rem 1.5rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; background: #f8fafc; }
        .table-title { font-weight: 700; color: var(--text-dark); }
        
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 1rem 1.5rem; text-align: left; border-bottom: 1px solid var(--border); font-size: 0.95rem; }
        th { background: #f1f5f9; font-weight: 600; color: var(--secondary); font-size: 0.8rem; text-transform: uppercase; }
        tr:last-child td { border-bottom: none; }
        
        .badge { padding: 0.25rem 0.6rem; border-radius: 20px; font-size: 0.75rem; font-weight: 600; }
        .bg-in { background: #dcfce7; color: #15803d; }
        .bg-out { background: #fee2e2; color: #b91c1c; }

        /* Tabs Logic (Simple Show/Hide) */
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        @media (max-width: 768px) {
            .sidebar { display: none; } /* Simplified for mobile */
            .main-content { margin-left: 0; padding: 1rem; }
        }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="brand">Keuangan & Stok</div>
        <div class="nav-item active" onclick="switchTab('dashboard')">ðŸ“Š Dashboard</div>
        <div class="nav-item" onclick="switchTab('money')">ðŸ’° Riwayat Keuangan</div>
        <div class="nav-item" onclick="switchTab('stock')">ðŸ“¦ Riwayat Barang</div>
    </div>

    <div class="main-content">
        
        <div class="header">
            <div>
                <h1 style="font-size: 1.5rem;">Laporan Terintegrasi</h1>
                <p style="color: var(--secondary);">Pantau arus kas dan barang dalam satu sistem.</p>
            </div>
            <div class="date-display" id="current-date">09 FEB 2026</div>
        </div>

        <div class="stats-grid">
            <div class="card">
                <div class="card-label">Saldo Kas</div>
                <div class="card-value text-blue" id="dash-balance">Rp 0</div>
            </div>
            <div class="card">
                <div class="card-label">Total Uang Masuk</div>
                <div class="card-value text-green" id="dash-in">Rp 0</div>
            </div>
            <div class="card">
                <div class="card-label">Total Uang Keluar</div>
                <div class="card-value text-red" id="dash-out">Rp 0</div>
            </div>
            <div class="card">
                <div class="card-label">Item Terjual (Qty)</div>
                <div class="card-value" id="dash-items-sold">0</div>
            </div>
        </div>

        <div class="input-section">
            <h3 style="margin-bottom: 1rem; font-size: 1.1rem;">Input Transaksi Baru</h3>
            <form id="unified-form">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Tanggal</label>
                        <input type="date" id="t-date" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Jenis Transaksi (Logika Otomatis)</label>
                        <select id="t-category" onchange="toggleFormFields()">
                            <option value="expense">ðŸ’¸ Biaya Operasional (Uang Keluar)</option>
                            <option value="income">ðŸ’µ Pendapatan Lain (Uang Masuk)</option>
                            <option value="buy_stock">ðŸ“¦ Beli Stok Barang (Uang Keluar + Stok Masuk)</option>
                            <option value="sell_stock">ðŸ›’ Jual Barang (Uang Masuk + Stok Keluar)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Keterangan / Nama Barang</label>
                        <input type="text" id="t-desc" placeholder="Contoh: Listrik / Sepatu" required>
                    </div>

                    <div class="form-group" id="field-qty" style="display: none;">
                        <label>Jumlah (Qty)</label>
                        <input type="number" id="t-qty" placeholder="0">
                    </div>

                    <div class="form-group">
                        <label>Nominal Rupiah (Total)</label>
                        <input type="number" id="t-amount" placeholder="Rp" required>
                    </div>

                    <div class="form-group">
                        <label>&nbsp;</label>
                        <button type="submit" class="btn-submit">Simpan Transaksi</button>
                    </div>
                </div>
                <p style="font-size: 0.8rem; color: var(--secondary); margin-top: 0.5rem; font-style: italic;">
                    *Tips: Jika memilih "Jual Barang", saldo bertambah dan stok berkurang otomatis.
                </p>
            </form>
        </div>

        <div id="tab-money" class="tab-content active">
            <div class="table-wrapper">
                <div class="table-header">
                    <span class="table-title">Laporan Arus Kas (Uang)</span>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Tanggal</th>
                            <th>Keterangan</th>
                            <th>Kategori</th>
                            <th>Arus</th>
                            <th style="text-align: right;">Nominal</th>
                        </tr>
                    </thead>
                    <tbody id="money-table-body">
                        </tbody>
                </table>
            </div>
        </div>

        <div id="tab-stock" class="tab-content">
            <div class="table-wrapper">
                <div class="table-header">
                    <span class="table-title">Laporan Mutasi Barang</span>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Tanggal</th>
                            <th>Nama Barang</th>
                            <th>Aktivitas</th>
                            <th>Jumlah (Qty)</th>
                        </tr>
                    </thead>
                    <tbody id="stock-table-body">
                        </tbody>
                </table>
            </div>
        </div>

    </div>

    <script>
        // --- 1. DATA AWAL (DATABASE) ---
        // Kita gabungkan data manual Anda (M, R, E) sebagai Uang Keluar
        let financialData = [
            { id: 1, date: '2026-02-09', desc: 'Pengeluaran -M', category: 'Biaya', type: 'out', amount: 1000000 },
            { id: 2, date: '2026-02-09', desc: 'Pengeluaran -R', category: 'Biaya', type: 'out', amount: 1050000 },
            { id: 3, date: '2026-02-09', desc: 'Pengeluaran -E', category: 'Biaya', type: 'out', amount: 150000 }
        ];

        let stockData = [
            { id: 1, date: '2026-02-08', item: 'Stok Awal', type: 'in', qty: 100 } // Contoh data stok
        ];

        // --- 2. FUNGSI UTILITIES ---
        const formatRupiah = (num) => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(num);
        const formatDate = (dateStr) => {
            const options = { day: '2-digit', month: 'short', year: 'numeric' };
            return new Date(dateStr).toLocaleDateString('id-ID', options);
        };

        // Set default date form to today
        document.getElementById('t-date').valueAsDate = new Date();

        // --- 3. LOGIKA UI & TAB ---
        function switchTab(tabName) {
            // Update Menu Active State
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            event.currentTarget.classList.add('active');

            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));

            if(tabName === 'dashboard' || tabName === 'money') {
                document.getElementById('tab-money').classList.add('active');
            }
            if(tabName === 'dashboard' || tabName === 'stock') {
                document.getElementById('tab-stock').classList.add('active'); // Show both on dashboard logic if needed, but for now we separate tables
                if(tabName === 'stock') {
                    document.getElementById('tab-money').classList.remove('active');
                    document.getElementById('tab-stock').classList.add('active');
                }
            }
        }

        function toggleFormFields() {
            const category = document.getElementById('t-category').value;
            const qtyField = document.getElementById('field-qty');
            
            if (category === 'buy_stock' || category === 'sell_stock') {
                qtyField.style.display = 'block';
                document.getElementById('t-qty').setAttribute('required', 'required');
            } else {
                qtyField.style.display = 'none';
                document.getElementById('t-qty').removeAttribute('required');
            }
        }

        // --- 4. CORE ENGINE (RENDER & HITUNG) ---
        function refreshSystem() {
            const moneyBody = document.getElementById('money-table-body');
            const stockBody = document.getElementById('stock-table-body');
            
            moneyBody.innerHTML = '';
            stockBody.innerHTML = '';

            let totalIn = 0, totalOut = 0, soldQty = 0;

            // Sort Data (Terbaru diatas)
            financialData.sort((a,b) => new Date(b.date) - new Date(a.date));
            stockData.sort((a,b) => new Date(b.date) - new Date(a.date));

            // Render Uang
            financialData.forEach(trx => {
                if(trx.type === 'in') totalIn += trx.amount;
                else totalOut += trx.amount;

                const row = `<tr>
                    <td>${formatDate(trx.date)}</td>
                    <td>${trx.desc}</td>
                    <td><span style="font-size:0.8rem; color:#64748b;">${trx.category}</span></td>
                    <td><span class="badge ${trx.type === 'in' ? 'bg-in' : 'bg-out'}">${trx.type === 'in' ? 'Masuk' : 'Keluar'}</span></td>
                    <td style="text-align: right; font-weight:600;" class="${trx.type === 'in' ? 'text-green' : 'text-red'}">
                        ${trx.type === 'in' ? '+' : '-'} ${formatRupiah(trx.amount)}
                    </td>
                </tr>`;
                moneyBody.innerHTML += row;
            });

            // Render Stok
            stockData.forEach(item => {
                if(item.type === 'out') soldQty += parseInt(item.qty);

                const row = `<tr>
                    <td>${formatDate(item.date)}</td>
                    <td>${item.item}</td>
                    <td><span class="badge ${item.type === 'in' ? 'bg-in' : 'bg-out'}">${item.type === 'in' ? 'Barang Masuk' : 'Barang Keluar'}</span></td>
                    <td style="font-weight:bold;">${item.qty} Pcs</td>
                </tr>`;
                stockBody.innerHTML += row;
            });

            // Update Cards
            document.getElementById('dash-in').innerText = formatRupiah(totalIn);
            document.getElementById('dash-out').innerText = formatRupiah(totalOut);
            document.getElementById('dash-balance').innerText = formatRupiah(totalIn - totalOut);
            document.getElementById('dash-items-sold').innerText = soldQty;
        }

        // --- 5. HANDLE SUBMIT (SAMBUNGAN LOGIC) ---
        document.getElementById('unified-form').addEventListener('submit', function(e) {
            e.preventDefault();

            const date = document.getElementById('t-date').value;
            const category = document.getElementById('t-category').value;
            const desc = document.getElementById('t-desc').value;
            const amount = parseFloat(document.getElementById('t-amount').value);
            const qty = parseFloat(document.getElementById('t-qty').value) || 0;

            // LOGIKA SAMBUNGAN (INTEGRASI)
            
            // 1. Jika Biaya Biasa (Listrik, Gaji, dll)
            if (category === 'expense') {
                financialData.push({ id: Date.now(), date, desc, category: 'Operasional', type: 'out', amount });
            }
            
            // 2. Jika Pendapatan Biasa (Jasa, dll)
            else if (category === 'income') {
                financialData.push({ id: Date.now(), date, desc, category: 'Pendapatan', type: 'in', amount });
            }

            // 3. Jika BELI Barang (Uang -, Stok +)
            else if (category === 'buy_stock') {
                financialData.push({ id: Date.now(), date, desc: `Beli Stok: ${desc}`, category: 'Pembelian Stok', type: 'out', amount });
                stockData.push({ id: Date.now(), date, item: desc, type: 'in', qty });
            }

            // 4. Jika JUAL Barang (Uang +, Stok -)
            else if (category === 'sell_stock') {
                financialData.push({ id: Date.now(), date, desc: `Penjualan: ${desc}`, category: 'Penjualan', type: 'in', amount });
                stockData.push({ id: Date.now(), date, item: desc, type: 'out', qty });
            }

            // Reset & Refresh
            e.target.reset();
            document.getElementById('t-date').valueAsDate = new Date();
            toggleFormFields(); // hide qty field again
            refreshSystem();
            
            // Feedback sederhana
            alert('Data berhasil disimpan!');
        });

        // Initialize
        refreshSystem();

    </script>
</body>
</html>
